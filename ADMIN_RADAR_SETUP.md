# 主理人雷达系统 - 配置指南

## 📋 第一步：在 Notion 中创建数据库

### 创建 "Redemption Logs" 数据库

1. 在你的 Notion Workspace 中创建一个新的数据库（Table 视图）
2. 命名为：**Redemption Logs**
3. 添加以下字段（列）：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| Log ID | Title（标题） | 自动生成的流水号 |
| Attempted Code | Text（文本） | 用户输入的兑换码 |
| Status | Select（单选） | 选项：🟢 成功、🔴 失败 |
| Reason | Text（文本） | 失败原因或成功类型 |
| Device ID | Text（文本） | 设备指纹 |
| Email | Email（邮箱） | 用户邮箱 |
| Time | Date（日期） | 尝试时间（包含时间） |
| IP Address | Text（文本） | IP 地址 |

### 获取 Database ID

1. 在 Notion 中打开刚创建的 "Redemption Logs" 数据库
2. 复制浏览器地址栏中的 URL
3. URL 格式：`https://www.notion.so/xxxxx?v=yyyyy`
4. `xxxxx` 就是你的 Database ID（32位字符）

---

## 🔧 第二步：配置环境变量

在你的 `.env.local` 文件中添加以下两个环境变量：

```bash
# Redemption Logs 数据库 ID
NOTION_DB_REDEMPTION_LOGS=你的Database_ID

# 管理员密钥（用于访问雷达页面）
ADMIN_SECRET=你的超级密码
```

### 示例：

```bash
NOTION_DB_REDEMPTION_LOGS=1234567890abcdef1234567890abcdef
ADMIN_SECRET=my-super-secret-admin-password-2024
```

---

## 🚀 第三步：部署

```bash
git add .
git commit -m "添加主理人雷达系统"
git push
```

---

## 📱 第四步：使用雷达系统

### 访问雷达页面

1. 访问：`https://你的域名/admin/radar`
2. 输入你在 `.env.local` 中设置的 `ADMIN_SECRET`
3. 点击"进入雷达"

### 功能说明

- **实时监控**：每5秒自动刷新一次
- **统计数据**：显示总尝试次数、成功次数、失败次数
- **筛选功能**：
  - 按兑换码搜索
  - 按状态筛选（成功/失败）
- **详细信息**：
  - 兑换码
  - 用户邮箱
  - 失败原因
  - 设备指纹
  - IP 地址
  - 时间戳

---

## 🎯 使用场景

### 1. 监控兑换活动
实时查看有多少人在尝试兑换，成功率如何

### 2. 排查问题
当用户反馈"兑换码用不了"时，可以：
1. 在雷达中搜索该兑换码
2. 查看失败原因
3. 快速定位问题

### 3. 防止滥用
通过 Device ID 和 IP 地址，可以识别：
- 同一设备多次尝试不同兑换码
- 同一 IP 地址的异常行为

### 4. 数据分析
- 哪些兑换码被使用最多
- 失败的主要原因是什么
- 用户行为模式分析

---

## 🔒 安全提示

1. **保护好 ADMIN_SECRET**：不要泄露给任何人
2. **定期更换密钥**：建议每月更换一次
3. **限制访问**：只在需要时访问雷达页面
4. **不要截图分享**：雷达页面包含敏感信息

---

## 📊 日志记录的情况

系统会自动记录以下所有情况：

### ✅ 成功情况
- 首次激活
- 重复登录（已激活的码再次使用）

### ❌ 失败情况
- 未输入兑换码
- 兑换码不存在
- 兑换码已失效
- 数据格式错误
- 服务器错误

---

## 🎨 界面预览

雷达页面采用深蓝色主题（Midnight Blue #0A1628），与你的 Cognitive 模块风格一致：

- 成功记录：绿色高亮
- 失败记录：红色高亮
- 实时刷新指示器
- 优雅的动画效果

---

## 💡 下一步优化建议

1. **邮件通知**：当出现异常失败时自动发送邮件
2. **数据导出**：支持导出 CSV 格式的日志
3. **高级筛选**：按时间范围、设备类型等筛选
4. **可视化图表**：显示兑换趋势图

---

需要帮助？随时联系开发者！

