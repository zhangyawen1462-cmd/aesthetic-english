# 🎯 实际页面权限控制实施计划

## 📋 需要添加权限控制的位置

### 1. 课程列表页面（添加锁图标）

#### Business 课程列表
**文件**：`components/course/BusinessRiverView.tsx`

**需要添加**：
- 季度会员看到：卡片右上角显示 🔒 锁图标
- 点击后：跳转到兑换页面或显示升级提示
- 年度/永久会员：正常显示，无锁

**实施位置**：
```typescript
// 在课程卡片上添加
{!hasAccess && (
  <div className="absolute top-3 right-3 z-10">
    <Lock className="text-white bg-black/50 p-2 rounded-full" size={24} />
  </div>
)}
```

---

#### Cognitive 课程列表
**文件**：`components/course/CognitiveCatalogView.tsx`

**需要添加**：
- Sample 课程：所有人可看
- 完整课程：季度会员显示锁图标
- 年度/永久会员：全部解锁

---

#### Daily 课程列表
**文件**：`components/course/DailyCinemaView.tsx`

**需要添加**：
- 所有会员都可访问
- 无需添加锁图标

---

### 2. 课程详情页面（使用 ContentGate）

#### 视频播放器保护
**文件**：`app/course/[category]/[courseId]/page.tsx`

**需要添加**：
```typescript
import ContentGate from '@/components/ContentGate';
import { useMembership } from '@/context/MembershipContext';

// 在视频区域外层包裹
<ContentGate section={category as VideoSection} isSample={lesson.isSample}>
  <video ... />
</ContentGate>
```

**效果**：
- 季度会员访问 Business 课程：显示磨砂玻璃遮罩
- 年度会员：正常播放

---

### 3. 下载/导出功能

#### ModuleScript 组件
**文件**：`components/ModuleScript.tsx`

**需要添加**：
```typescript
import { useMembership } from '@/context/MembershipContext';
import { canExportNotes } from '@/lib/permissions';

const { tier } = useMembership();

// 导出按钮
{canExportNotes(tier) ? (
  <button onClick={handleExport}>
    📄 导出字幕
  </button>
) : (
  <button disabled className="opacity-50 cursor-not-allowed">
    📄 导出字幕（需要年度会员）
  </button>
)}
```

---

#### ModuleVocab 组件
**文件**：`components/ModuleVocab.tsx`

**需要添加**：
- 导出词汇表按钮
- 年度/永久会员可用

---

#### ModuleGrammar 组件
**文件**：`components/ModuleGrammar.tsx`

**需要添加**：
- 导出语法笔记按钮
- 年度/永久会员可用

---

### 4. AI 对话限制

#### ModuleSalon 组件
**文件**：`components/ModuleSalon.tsx`

**需要添加**：
```typescript
import { useMembership } from '@/context/MembershipContext';
import { getGabbyConfig } from '@/lib/permissions';

const { tier } = useMembership();
const gabbyConfig = getGabbyConfig(tier);

// 季度会员：显示预览模式
if (!gabbyConfig.canChat) {
  return (
    <div className="text-center py-12">
      <Lock size={48} className="mx-auto mb-4 opacity-30" />
      <h3 className="text-xl mb-2">Gabby AI 语境教练</h3>
      <p className="text-sm opacity-60 mb-6">
        升级到年度会员解锁 AI 对话功能
      </p>
      <Link href="/redeem">
        <button className="px-6 py-3 bg-accent text-white rounded-lg">
          立即升级
        </button>
      </Link>
    </div>
  );
}

// 年度会员：限制 15 次
const [messageCount, setMessageCount] = useState(0);

if (messageCount >= gabbyConfig.dailyLimit) {
  // 显示达到上限提示
}
```

---

## 🎨 UI 设计规范

### 锁图标样式

**课程卡片锁图标**：
```tsx
<div className="absolute top-3 right-3 z-10 group">
  <div className="w-10 h-10 rounded-full bg-black/60 backdrop-blur-sm flex items-center justify-center border border-white/20 shadow-lg">
    <Lock size={18} className="text-white" />
  </div>
  {/* Tooltip */}
  <div className="absolute top-12 right-0 opacity-0 group-hover:opacity-100 transition-opacity bg-black/80 text-white text-xs px-3 py-2 rounded-lg whitespace-nowrap">
    需要年度会员
  </div>
</div>
```

---

### 禁用按钮样式

**导出按钮（禁用状态）**：
```tsx
<button 
  disabled 
  className="px-4 py-2 bg-gray-200 text-gray-400 rounded-lg cursor-not-allowed opacity-50 flex items-center gap-2"
>
  <Lock size={14} />
  <span>导出笔记（需要年度会员）</span>
</button>
```

---

### ContentGate 遮罩样式

**已实现**：
- 磨砂玻璃背景
- 呼吸动画锁图标
- 升级按钮
- 当前会员状态显示

---

## 📝 实施步骤

### 阶段 1：课程列表锁图标（1-2 小时）

**优先级**：⭐⭐⭐⭐⭐

1. ✅ BusinessRiverView - 添加锁图标
2. ✅ CognitiveCatalogView - 添加锁图标（区分 Sample）
3. ✅ DailyCinemaView - 无需修改（全员可访问）

**测试**：
- 季度会员看到 Business 卡片有锁
- 年度会员看到 Business 卡片无锁
- 点击锁图标显示提示

---

### 阶段 2：课程详情页保护（2-3 小时）

**优先级**：⭐⭐⭐⭐⭐

1. ✅ 在视频播放器外层添加 ContentGate
2. ✅ 处理 Sample 课程逻辑
3. ✅ 测试不同会员类型的访问

**测试**：
- 季度会员访问 Business 课程显示磨砂玻璃
- 年度会员正常播放
- Sample 课程所有人可看

---

### 阶段 3：下载功能限制（1-2 小时）

**优先级**：⭐⭐⭐⭐

1. ✅ ModuleScript - 导出字幕按钮
2. ✅ ModuleVocab - 导出词汇按钮
3. ✅ ModuleGrammar - 导出笔记按钮

**测试**：
- 季度会员看到禁用按钮
- 年度会员可以导出
- 永久会员可以导出

---

### 阶段 4：AI 对话限制（2-3 小时）

**优先级**：⭐⭐⭐

1. ✅ ModuleSalon - 添加权限检查
2. ✅ 季度会员显示预览模式
3. ✅ 年度会员限制 15 次
4. ✅ 永久会员无限对话

**测试**：
- 季度会员看到升级提示
- 年度会员可以对话 15 次
- 永久会员无限对话

---

## 🧪 测试清单

### 测试场景 1：季度会员

- [ ] 访问 Business 列表页，看到锁图标
- [ ] 点击 Business 课程，显示磨砂玻璃遮罩
- [ ] 访问 Cognitive Sample 课程，可以正常观看
- [ ] 访问 Cognitive 完整课程，显示遮罩
- [ ] 访问 Daily 课程，正常观看
- [ ] 尝试导出字幕，按钮禁用
- [ ] 访问 AI 对话，显示升级提示

---

### 测试场景 2：年度会员

- [ ] 访问 Business 列表页，无锁图标
- [ ] 访问所有课程，正常观看
- [ ] 导出字幕，成功下载
- [ ] 导出词汇，成功下载
- [ ] AI 对话，可以使用 15 次
- [ ] 第 16 次对话，显示达到上限

---

### 测试场景 3：永久会员

- [ ] 访问所有课程，正常观看
- [ ] 所有导出功能可用
- [ ] AI 对话无限制
- [ ] 下载原片功能可用

---

## 🎯 优先级排序

### 立即实施（今天）

1. **Business 课程列表锁图标** - 最直观的权限提示
2. **课程详情页 ContentGate** - 核心权限控制

### 明天实施

3. **下载功能限制** - 增值服务差异化
4. **AI 对话限制** - 成本控制

---

## 💡 实施建议

### 从最简单的开始

**第一步**：Business 课程列表添加锁图标
- 代码量少（~20 行）
- 效果明显
- 容易测试

**第二步**：课程详情页使用 ContentGate
- 组件已经写好
- 只需包裹视频区域
- 立即看到效果

**第三步**：下载按钮禁用
- 简单的条件渲染
- 用户体验提升

**第四步**：AI 对话限制
- 稍微复杂（需要计数）
- 但功能完整

---

## 🚀 开始实施

你想从哪个开始？

1. **Business 课程列表锁图标**（最简单，10 分钟）
2. **课程详情页 ContentGate**（核心功能，30 分钟）
3. **下载功能限制**（增值服务，20 分钟）
4. **AI 对话限制**（完整功能，40 分钟）

**我建议从 1 开始，逐步完成！**







