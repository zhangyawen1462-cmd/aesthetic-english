# æƒé™ç³»ç»Ÿç‰ˆæœ¬å¯¹æ¯”ä¸è¿ç§»æŒ‡å—

## ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”

### V1 (å½“å‰ç‰ˆæœ¬) vs V2 (æ¨èç‰ˆæœ¬)

| ç‰¹æ€§ | V1 (lib/permissions.ts) | V2 (lib/permissions-v2.ts) | ä¼˜åŠ¿ |
|------|------------------------|---------------------------|------|
| **ä¼šå‘˜ç±»å‹** | ä¸­æ–‡å­—ç¬¦ä¸² | è‹±æ–‡æšä¸¾ | V2 æ›´è§„èŒƒï¼Œé¿å…ä¸­æ–‡ç¼–ç é—®é¢˜ |
| **Sample é€»è¾‘** | âŒ æœªå®ç° | âœ… å®Œæ•´å®ç° | V2 æ”¯æŒ"é’©å­"ç­–ç•¥ |
| **Gabby é…ç½®** | ç®€å•å¯¹è±¡ | å®Œæ•´é…ç½®å¯¹è±¡ | V2 åŒ…å« UI æ–‡æ¡ˆã€badge ç­‰ |
| **ç±»å‹å®‰å…¨** | éƒ¨åˆ† | å®Œæ•´ | V2 ç±»å‹å®šä¹‰æ›´ä¸¥æ ¼ |
| **å…¼å®¹æ€§** | - | âœ… æä¾›è½¬æ¢å‡½æ•° | V2 å¯å…¼å®¹æ—§ä»£ç  |

---

## ğŸ¯ V2 çš„æ ¸å¿ƒæ”¹è¿›

### 1. Sampleï¼ˆé’©å­ï¼‰é€»è¾‘

**V1 æ²¡æœ‰å®ç°**ï¼š
```typescript
// âŒ V1: æ— æ³•åŒºåˆ† Sample å’Œæ™®é€šè§†é¢‘
canAccessCourse('cognitive', 'quarterly') // ç›´æ¥è¿”å› false
```

**V2 å®Œæ•´å®ç°**ï¼š
```typescript
// âœ… V2: æ”¯æŒ Sample é’©å­ç­–ç•¥
checkVideoAccess('quarterly', 'cognitive', true)  // Sample: true
checkVideoAccess('quarterly', 'cognitive', false) // æ™®é€šè§†é¢‘: false
```

**å®é™…åº”ç”¨**ï¼š
- å­£åº¦ä¼šå‘˜åœ¨ Cognitive ç²¾é€‰é¡µå¯ä»¥çœ‹ 1 æœŸ Sample
- è®©ä»–"å°åˆ°ç”œå¤´"ï¼Œäº§ç”Ÿå‡çº§å†²åŠ¨

---

### 2. Gabby å®Œæ•´é…ç½®

**V1 ç®€å•ç‰ˆæœ¬**ï¼š
```typescript
// âŒ V1: åªæœ‰åŸºç¡€æƒé™åˆ¤æ–­
const hasAccess = PERMISSIONS.aiChat.canAccess(tier);
const limit = PERMISSIONS.aiChat.getLimit(tier);
```

**V2 å®Œæ•´é…ç½®**ï¼š
```typescript
// âœ… V2: è¿”å›å®Œæ•´é…ç½®å¯¹è±¡
const config = getGabbyConfig('yearly');
// {
//   canChat: true,
//   dailyLimit: 15,
//   allowPersonas: false,
//   placeholder: "Message Gabby...",
//   statusText: "15 æ¬¡/æœŸ",
//   badge: "365"
// }
```

**å®é™…åº”ç”¨**ï¼š
```typescript
// ç›´æ¥ç”¨äº UI æ¸²æŸ“
<input placeholder={config.placeholder} disabled={!config.canChat} />
<span className="badge">{config.badge}</span>
<p>{config.statusText}</p>
```

---

### 3. ç±»å‹å®‰å…¨

**V1**ï¼š
```typescript
type MembershipTier = 'å­£åº¦ä¼šå‘˜' | 'å¹´åº¦ä¼šå‘˜' | 'æ°¸ä¹…ä¼šå‘˜' | null;
```
â†’ ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œå®¹æ˜“æ‹¼å†™é”™è¯¯

**V2**ï¼š
```typescript
type MembershipTier = 'quarterly' | 'yearly' | 'lifetime' | null;
```
â†’ è‹±æ–‡æšä¸¾ï¼ŒIDE è‡ªåŠ¨è¡¥å…¨ï¼Œé¿å…é”™è¯¯

---

## ğŸ”„ è¿ç§»æ­¥éª¤

### æ–¹æ¡ˆ Aï¼šå®Œå…¨è¿ç§»ï¼ˆæ¨èï¼‰

#### æ­¥éª¤ 1ï¼šæ›¿æ¢æ–‡ä»¶
```bash
mv lib/permissions.ts lib/permissions-v1-backup.ts
mv lib/permissions-v2.ts lib/permissions.ts
```

#### æ­¥éª¤ 2ï¼šæ›´æ–° localStorage
```typescript
// åœ¨ app/layout.tsx æˆ–å…¥å£æ–‡ä»¶æ·»åŠ è¿ç§»é€»è¾‘
useEffect(() => {
  const oldTier = localStorage.getItem('membershipType');
  if (oldTier) {
    const newTier = convertTierToEnglish(oldTier);
    localStorage.setItem('membershipType', newTier || '');
  }
}, []);
```

#### æ­¥éª¤ 3ï¼šæ›´æ–°ç»„ä»¶
```typescript
// æ—§ä»£ç 
const membershipType = localStorage.getItem('membershipType') as 'å­£åº¦ä¼šå‘˜' | 'å¹´åº¦ä¼šå‘˜' | 'æ°¸ä¹…ä¼šå‘˜';

// æ–°ä»£ç 
const membershipType = localStorage.getItem('membershipType') as MembershipTier;
```

---

### æ–¹æ¡ˆ Bï¼šæ¸è¿›å¼è¿ç§»ï¼ˆä¿å®ˆï¼‰

ä¿ç•™ V1ï¼Œåœ¨æ–°åŠŸèƒ½ä¸­ä½¿ç”¨ V2ï¼š

```typescript
// lib/permissions.ts (V1 - ä¿ç•™)
export const PERMISSIONS_V1 = { ... };

// lib/permissions-v2.ts (V2 - æ–°åŠŸèƒ½ä½¿ç”¨)
export const PERMISSIONS = { ... };

// åœ¨ç»„ä»¶ä¸­
import { PERMISSIONS } from '@/lib/permissions-v2'; // æ–°åŠŸèƒ½
import { PERMISSIONS_V1 } from '@/lib/permissions'; // æ—§åŠŸèƒ½
```

---

## ğŸ“ ä»£ç ç¤ºä¾‹å¯¹æ¯”

### ç¤ºä¾‹ 1ï¼šè§†é¢‘è®¿é—®æƒé™

**V1 ä»£ç **ï¼š
```typescript
import { canAccessCourse } from '@/lib/permissions';

const canView = canAccessCourse('cognitive', 'å¹´åº¦ä¼šå‘˜');
```

**V2 ä»£ç **ï¼š
```typescript
import { checkVideoAccess } from '@/lib/permissions';

const canView = checkVideoAccess('yearly', 'cognitive', false);
const canViewSample = checkVideoAccess('quarterly', 'cognitive', true); // ğŸ†• æ”¯æŒ Sample
```

---

### ç¤ºä¾‹ 2ï¼šGabby AI é…ç½®

**V1 ä»£ç **ï¼š
```typescript
const hasAccess = PERMISSIONS.aiChat.canAccess('å¹´åº¦ä¼šå‘˜');
const limit = PERMISSIONS.aiChat.getLimit('å¹´åº¦ä¼šå‘˜');

// æ‰‹åŠ¨å†™ UI æ–‡æ¡ˆ
<input 
  disabled={!hasAccess} 
  placeholder={hasAccess ? "Message..." : "Upgrade to chat..."} 
/>
```

**V2 ä»£ç **ï¼š
```typescript
const config = getGabbyConfig('yearly');

// ç›´æ¥ä½¿ç”¨é…ç½®
<input 
  disabled={!config.canChat} 
  placeholder={config.placeholder} 
/>
<span className="badge">{config.badge}</span>
```

---

### ç¤ºä¾‹ 3ï¼šä¸‹è½½æƒé™

**V1 ä»£ç **ï¼š
```typescript
const canDownload = PERMISSIONS.download.canDownload('æ°¸ä¹…ä¼šå‘˜');

// æ‰‹åŠ¨åˆ¤æ–­æ˜¾ç¤ºä»€ä¹ˆ
{canDownload && <button>ä¸‹è½½</button>}
```

**V2 ä»£ç **ï¼š
```typescript
const capabilities = PERMISSIONS.assets.getDownloadCapabilities('lifetime');

// æ›´è¯¦ç»†çš„æƒé™ä¿¡æ¯
{capabilities.notes && <button>ğŸ“„ å¯¼å‡ºç¬”è®°</button>}
{capabilities.rawVideo && <button>ğŸ¬ ä¸‹è½½åŸç‰‡</button>}
{capabilities.audio && <button>ğŸµ ä¸‹è½½éŸ³é¢‘</button>}
<p>{capabilities.description}</p>
```

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### å¯¹äºæ–°é¡¹ç›®
âœ… **ç›´æ¥ä½¿ç”¨ V2**
- æ›´è§„èŒƒçš„ç±»å‹å®šä¹‰
- æ›´å®Œæ•´çš„åŠŸèƒ½
- æ›´å¥½çš„ IDE æ”¯æŒ

### å¯¹äºç°æœ‰é¡¹ç›®
âœ… **æ¸è¿›å¼è¿ç§»**
1. ä¿ç•™ V1 ä½œä¸ºå¤‡ä»½
2. æ–°åŠŸèƒ½ä½¿ç”¨ V2
3. é€æ­¥è¿ç§»æ—§ä»£ç 
4. ä½¿ç”¨è½¬æ¢å‡½æ•°å…¼å®¹

---

## ğŸ”§ å…¼å®¹æ€§å·¥å…·

V2 æä¾›äº†è½¬æ¢å‡½æ•°ï¼Œç¡®ä¿å¹³æ»‘è¿ç§»ï¼š

```typescript
// ä¸­æ–‡ â†’ è‹±æ–‡
const englishTier = convertTierToEnglish('å­£åº¦ä¼šå‘˜'); // 'quarterly'

// è‹±æ–‡ â†’ ä¸­æ–‡
const chineseTier = convertTierToChinese('yearly'); // 'å¹´åº¦ä¼šå‘˜'

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const oldTier = localStorage.getItem('membershipType'); // 'å­£åº¦ä¼šå‘˜'
const newTier = convertTierToEnglish(oldTier); // 'quarterly'
const hasAccess = checkVideoAccess(newTier, 'cognitive', false);
```

---

## ğŸ“Š è¿ç§»æ¸…å•

- [ ] å¤‡ä»½ V1 æ–‡ä»¶
- [ ] æ›¿æ¢ä¸º V2 æ–‡ä»¶
- [ ] æ›´æ–° localStorage æ•°æ®
- [ ] æ›´æ–°ç»„ä»¶å¯¼å…¥
- [ ] æ›´æ–°ç±»å‹å®šä¹‰
- [ ] æµ‹è¯•æ‰€æœ‰æƒé™é€»è¾‘
- [ ] æ›´æ–°å¼€å‘è€…é¢æ¿
- [ ] æ›´æ–°æ–‡æ¡£

---

## ğŸš€ å»ºè®®

**ç«‹å³è¿ç§»åˆ° V2**ï¼Œå› ä¸ºï¼š

1. âœ… **Sample é€»è¾‘**ï¼šæ”¯æŒ"é’©å­"ç­–ç•¥ï¼Œæé«˜è½¬åŒ–ç‡
2. âœ… **å®Œæ•´é…ç½®**ï¼šGabby é…ç½®åŒ…å«æ‰€æœ‰ UI éœ€è¦çš„ä¿¡æ¯
3. âœ… **ç±»å‹å®‰å…¨**ï¼šè‹±æ–‡æšä¸¾é¿å…æ‹¼å†™é”™è¯¯
4. âœ… **å‘åå…¼å®¹**ï¼šæä¾›è½¬æ¢å‡½æ•°ï¼Œä¸å½±å“ç°æœ‰æ•°æ®
5. âœ… **æ›´æ˜“ç»´æŠ¤**ï¼šä»£ç æ›´æ¸…æ™°ï¼Œæ³¨é‡Šæ›´è¯¦ç»†

---

**ä¸‹ä¸€æ­¥**ï¼šæ˜¯å¦éœ€è¦æˆ‘å¸®ä½ æ‰§è¡Œè¿ç§»ï¼Ÿ

