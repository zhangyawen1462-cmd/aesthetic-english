# 🔑 环境变量配置指南

## 需要添加到 `.env.local` 的配置

请在你的 `.env.local` 文件中添加以下配置：

```bash
# ============================================
# Notion 兑换码数据库配置
# ============================================

# 兑换码数据库 ID（新增）
NOTION_DB_REDEMPTION=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# ============================================
# JWT 安全配置（新增）
# ============================================

# JWT 密钥（用于加密 Cookie）
JWT_SECRET=your-super-secret-key-min-32-chars-change-in-production
```

---

## 📋 获取配置的详细步骤

### 1. 获取 NOTION_DB_REDEMPTION

#### Step 1: 在 Notion 中创建兑换码数据库

1. 打开 Notion，创建一个新的 Database（Full Page）
2. 命名为：`兑换码金库` 或 `Redemption Codes`

#### Step 2: 添加以下字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| **Code** | Title | 兑换码（如 AE-LIFE-001-ABCD） |
| **Type** | Select | 选项：`永久会员`、`年度会员`、`季度会员` |
| **Status** | Select | 选项：`🆕 待售`、`✅ 已激活` |
| **User Email** | Email | 用户邮箱 |
| **ActivatedDate** | Date | 激活日期 |

#### Step 3: 共享数据库给 Integration

1. 点击数据库右上角的 **Share** 按钮
2. 搜索你的 Integration 名称（应该已经创建过）
3. 点击 **Invite** 邀请

#### Step 4: 获取 Database ID

1. 打开数据库页面
2. 查看浏览器地址栏，URL 格式为：
   ```
   https://www.notion.so/{workspace}/{database_id}?v={view_id}
   ```
3. 复制 `{database_id}` 部分（32位字符，可能包含连字符）
4. 粘贴到 `.env.local` 的 `NOTION_DB_REDEMPTION` 中

**示例**：
```
URL: https://www.notion.so/myworkspace/1234567890abcdef1234567890abcdef?v=...
Database ID: 1234567890abcdef1234567890abcdef
```

---

### 2. 生成 JWT_SECRET

#### 方法 1: 使用 Node.js（推荐）

在终端运行：
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

会输出类似：
```
a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6a7b8c9d0e1f2
```

#### 方法 2: 在线生成

访问：https://generate-secret.vercel.app/32

#### 方法 3: 手动创建

使用至少 32 位的随机字符串，包含大小写字母、数字和特殊字符。

**⚠️ 重要**：
- 生产环境必须使用强密码
- 不要使用示例中的密码
- 不要将密码提交到 Git

---

## ✅ 配置完成后的 `.env.local` 示例

```bash
# Notion API（已有）
NOTION_API_KEY=secret_xxxxxxxxxxxxxxxxxxxxx
NOTION_DB_LESSONS=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_DB_VOCABULARY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_DB_GRAMMAR=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_DB_RECALL=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 🆕 新增：兑换码数据库
NOTION_DB_REDEMPTION=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 🆕 新增：JWT 密钥
JWT_SECRET=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6a7b8c9d0e1f2

# OpenAI API（已有）
OPENAI_API_KEY=sk-...

# 其他配置...
```

---

## 🧪 验证配置

配置完成后，在终端运行：

```bash
# 检查环境变量是否加载
npm run dev
```

如果看到类似错误：
```
Error: NOTION_DB_REDEMPTION is not defined
```

说明配置未生效，请：
1. 确认 `.env.local` 文件在项目根目录
2. 重启开发服务器
3. 检查变量名是否拼写正确

---

## 📝 下一步

配置完成后，告诉我，我将继续：
1. 创建兑换码激活页面
2. 更新 ModuleSalon.tsx 集成后端验证
3. 测试完整流程

---

## 🔒 安全提示

- ✅ `.env.local` 已在 `.gitignore` 中，不会被提交
- ✅ 不要在代码中硬编码密钥
- ✅ 生产环境使用 Vercel 的环境变量管理
- ✅ 定期更换 JWT_SECRET（如果泄露）






