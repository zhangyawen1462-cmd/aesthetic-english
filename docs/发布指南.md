# 🚀 自动化发布完整指南

## 📍 快速开始

访问发布台：`http://localhost:8080/admin/publish`

---

## ✨ 核心功能

**一键完成所有操作**：上传素材 → AI 生成内容 → 自动发布到 Notion

**节省时间**：从 20 分钟缩短到 3 分钟

---

## 📋 封面需求矩阵

### 场景 1：仅 Archives 的视频
```
Display_Position: none
需要封面: 1 张
  └─ 16:9 归档封面 → Cover_URL_16_9
```

### 场景 2：Dashboard/Daily Cinema 精选视频
```
Display_Position: dashboard-featured / daily-video
需要封面: 2 张
  ├─ 精选封面（3:4/1:1/9:16）→ Cover_URL
  └─ 16:9 归档封面 → Cover_URL_16_9

注意：Daily Cinema 只显示 3-4 期视频课程（随机）
```

### 场景 3：Cognitive/Business 视频
```
Display_Position: cognitive-featured / business-featured
需要封面: 1 张
  └─ 16:9 封面 → Cover_URL（同时用于精选和归档）

注意：Cognitive 和 Business 精选区使用 16:9 封面，不需要额外准备
```

---

## 📐 封面尺寸要求

### 精选封面（竖屏/方形）

| 比例 | 推荐像素 | 最小像素 | 适用场景 |
|------|---------|---------|----------|
| **3:4** | 1200×1600 | 900×1200 | 标准竖屏，人物特写 |
| **1:1** | 1200×1200 | 800×800 | 正方形，氛围图片 |
| **9:16** | 1080×1920 | 720×1280 | 超竖屏，短视频风格 |

### 归档封面（横屏）

| 比例 | 推荐像素 | 最小像素 | 适用场景 |
|------|---------|---------|----------|
| **16:9** | 1920×1080 | 1280×720 | Archives 统一使用 |

---

## 🚀 发布流程

### 第一步：准备素材

```
📁 素材清单
├─ 📷 精选封面（根据分类和位置）
├─ 📷 归档封面（16:9，如需要）
├─ 🎬 视频文件（文件名不要有空格！）
└─ 📝 SRT 字幕文件
```

### 第二步：填写表单

```
Lesson ID:     daily-coffee-01
期数:          01  ← 仅用于显示 "Vol.01"，不控制位置
英文标题:      Morning Coffee Ritual
中文标题:      晨间咖啡仪式
分类:          Daily / Cognitive / Business
展示类型:      🎬 视频课程 / 📝 文字课程
展示位置:      根据分类选择  ← 控制显示在哪个页面
排序顺序:      1  ← 数字越小越靠前，控制显示顺序
封面尺寸:      📱 3:4 / ⬜ 1:1 / 📲 9:16
```

**字段说明**：
- **EP（期数）**：仅用于显示，如 "Vol.01"、"Vol.02"
- **Display_Position（展示位置）**：控制课程显示在哪个页面
  - `dashboard-featured` - Dashboard 精选
  - `daily-video` - Daily Cinema 视频区（随机 3-4 期）
  - `cognitive-featured` - Cognitive 精选（前 2 期）
  - `business-featured` - Business 精选（前 2 期）
  - `none` - 只在 Archives 显示
- **Sort_Order（排序顺序）**：控制同一位置的显示顺序
  - 数字越小越靠前（1 > 2 > 3...）
  - Dashboard：按 Sort_Order 排序
  - Cognitive/Business：按 Sort_Order 显示前 2 期
  - Archives：按 Date 降序（最新的在前）

### 第三步：上传文件

系统会根据你的选择智能提示需要哪些封面：

- **仅 Archives**：只需上传 16:9 归档封面
- **Dashboard/Daily Cinema 精选**：需要精选封面 + 16:9 归档封面
  - Daily Cinema 只显示 3-4 期视频课程（随机选择）
- **Cognitive/Business**：只需 16:9 封面（同时用于精选和归档）
  - 精选区和归档区使用同一张 16:9 封面

### 第四步：一键发布

点击"一键发布"，系统自动：
1. 📤 上传文件到 Cloudflare R2
2. 🤖 AI 生成词汇/语法/回译
3. 📝 创建 Notion 页面
4. 🔗 自动关联所有数据

### 第五步：审核发布

1. 打开 Notion 中的课程
2. 检查 AI 生成的内容
3. 修改不准确的地方
4. 将 Status 从 `Draft` 改为 `Published`

---

## 🔧 环境配置

### 必需的环境变量（.env.local）

```bash
# Notion API
NOTION_API_KEY=ntn_xxxxx
NOTION_DB_LESSONS=xxxxx

# DeepSeek AI
DEEPSEEK_API_KEY=sk-xxxxx

# Cloudflare R2
R2_ACCOUNT_ID=xxxxx
R2_ACCESS_KEY_ID=xxxxx
R2_SECRET_ACCESS_KEY=xxxxx
R2_BUCKET_NAME=xxxxx
R2_PUBLIC_URL=https://xxxxx

# 可选数据库（不配置则跳过）
NOTION_DB_VOCABULARY=xxxxx
NOTION_DB_GRAMMAR=xxxxx
NOTION_DB_RECALL=xxxxx
```

### Notion 数据库字段

**Aesthetic English数据库** 必需字段：

```
ID (Title)
Title_EN (Rich Text)
Title_CN (Rich Text)
Category (Select: Daily / Cognitive / Business)
EP (Number)
Cover_URL (URL) - 精选封面
Cover_URL_16_9 (URL) - 归档封面
Cover_Ratio (Select: 3/4, 1/1, 9/16)
Video_URL (URL)
SRT_Raw (Rich Text)
Status (Select: Draft / Published)
Display_Type (Select: video / text)
Display_Position (Select)
Sort_Order (Number)
Date (Date)
```

---

## 💡 设计建议

### 精选封面（竖屏）

**3:4 竖屏**：
- ✅ 人物特写放在上半部分
- ✅ 文字放在下半部分
- ✅ 主体居中偏上

**1:1 正方形**：
- ✅ 主体完全居中
- ✅ 对称构图
- ✅ 适合氛围图片

**9:16 超竖屏**：
- ✅ 全身人物
- ✅ 主体在中间偏上
- ✅ 适合手机短视频风格

### 归档封面（横屏）

**16:9 横屏**：
- ✅ 主体居中
- ✅ 左右留白均衡
- ✅ 文字可以放在左侧或右侧
- ✅ 适合电影感构图

### 同一课程的两套封面应该：
- ✅ 使用相同的色调
- ✅ 使用相同的主体（如果可能）
- ✅ 保持品牌风格一致

---

## 🎯 最佳实践

### 1. 文件命名规范

```
✅ 好的命名：
- daily-01-cover-featured.jpg
- daily-01-cover-archive.jpg
- daily-01-video.mp4

❌ 避免的命名：
- cover 1.jpg  (有空格)
- 封面.jpg     (中文)
- IMG_1234.jpg (无意义)
```

### 2. 批量制作技巧

**Figma 模板法**：
1. 创建两个模板（竖屏 + 横屏）
2. 每期只需要替换图片和文字
3. 批量导出

**Photoshop 动作法**：
1. 录制裁切动作
2. 批量处理所有图片
3. 自动生成两套封面

---

## 💰 费用说明

**DeepSeek AI**：
- 单次生成：约 ¥0.005（不到1分钱）
- 月度成本（20期）：约 ¥0.1（1毛钱）

**Cloudflare R2**：
- 存储：$0.015/GB/月
- 流量：前 10GB 免费

---

## ❓ 常见问题

### Q1: EP（期数）和 Sort_Order 有什么区别？

**EP（期数）**：
- 仅用于显示，如 "Vol.01"、"Vol.02"
- 不控制课程的显示位置和顺序
- 帮助用户识别这是第几期内容

**Sort_Order（排序顺序）**：
- 控制课程在同一位置的显示顺序
- 数字越小越靠前
- 用于精确控制哪些课程优先显示

**示例**：
```
课程 A: EP=05, Sort_Order=1  → 显示为 "Vol.05"，排在第一位
课程 B: EP=01, Sort_Order=2  → 显示为 "Vol.01"，排在第二位
```

### Q2: 视频无法播放？

**检查**：
1. Video_URL 是否包含空格？
2. 视频格式是否支持（推荐 .mp4）
3. 视频文件是否成功上传？

**解决**：重新上传视频（确保文件名无空格）

### Q3: 词汇/语法数据为空？

**原因**：使用了手动创建而非发布台

**解决**：使用发布台重新发布，AI 会自动生成并关联

### Q4: 我只有一张图，怎么办？

**方案 1**：只上传精选封面，Archives 会自动使用精选封面

**方案 2**：用 Canva 的"调整大小"功能一键生成多个尺寸

### Q5: 提示"未配置 DEEPSEEK_API_KEY"？

**解决**：在 `.env.local` 中添加 API Key 并重启服务器

---

## ✅ 发布前检查清单

- [ ] 精选封面尺寸正确（根据选择的 Cover_Ratio）
- [ ] 归档封面尺寸为 16:9（如需要）
- [ ] 两套封面视觉风格一致（如需要）
- [ ] 视频文件名不包含空格和中文
- [ ] SRT 字幕文件格式正确
- [ ] Notion 中已添加所有必需字段
- [ ] .env.local 配置完整

---

## 🎊 总结

### 自动化系统的优势

✅ **省时**：从 20 分钟缩短到 3 分钟  
✅ **省心**：无需手动复制粘贴 URL  
✅ **省力**：AI 自动生成学习内容  
✅ **可靠**：减少人为错误  
✅ **智能**：根据场景自动提示需要哪些封面

### 完整工作流程

```
准备素材 → 填写表单 → 上传文件 → 一键发布 → 审核内容 → 完成！
```

现在，你只需要准备好素材，剩下的交给自动化系统！🎨

